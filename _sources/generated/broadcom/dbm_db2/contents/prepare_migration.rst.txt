.. _prepare_migration_module:


prepare_migration -- Generate a script to migrate Db2 object definitions (DDL) and data from a source subsystem to a target subsystem
=====================================================================================================================================

.. contents::
   :local:
   :depth: 1


Synopsis
--------

Generate a script to migrate Db2 object definitions (DDL) and data from a source subsystem to a target subsystem. You can specify which objects to include and apply changes to the objects as part of the migration. To execute the script, use the 'zowe dbm execute migration-script' command.

 

For details about command usage for automation, see DBM-Db2 samples at https://github.com/BroadcomMFD/dbm-db2-for-zowe-cli.







Parameters
----------

  object (type: str)
    Specifies the Db2 objects that you want to migrate. Use the optional include syntax to include related Db2 objects.

        

    Format: see object-file description.

    

    Note: The and options are mutually exclusive. 



  object_file (type: str)
    Specifies the local input file that contains a list of Db2 objects, separated by a semicolon, that you want to migrate. Use the optional include syntax to include related Db2 objects.

         

    Format:

    

    \<object-type\> \<object-name\> [include(\<related-object-type\>,...)];

    

    The required clause \<object-type\> \<object-name\>  identifies the specific Db2 (base) object:

        

    STOGROUP \<name\>

    DATABASE \<name\>

    TABLESPACE \<dbname.name\>

    TABLE \<schema.name\>

    INDEX \<schema.name\>

    VIEW \<schema.name\>

    ALIAS \<schema.name\>

    SYNONYM \<schema.name\>

    MQT \<schema.name\>

    SEQUENCE \<schema.name\>

    TRIGGER \<schema.name\>

    FUNCTION \<schema.name[.version]\>

    PROCEDURE \<schema.name[.version]\>

    

    The optional clause include(\<related-object-type\>,...) identifies one or more, comma separated related object types that you want to include in the object list. You can specify STOGROUP, DATABASE, TABLESPACE, TABLE, INDEX, VIEW, SYNONYM, MQT-ALL, TRIGGER, ROUTINE, PARENTS, CHILDREN, and ALL.

        

    Example:

        

    table sysibm.systables include (tablespace, database, index);

    database db1 include(children);

    

    Note: The and options are mutually exclusive. 



  source_db2 (*required*, type: str)
    Specifies the source Db2 subsystem or the data sharing group where the object definitions and data that you want to migrate are located.

    

     Note: If you specify the data sharing group, the first active Db2 subsystem in the group is used. 



  target_db2 (*required*, type: str)
    Specifies the target Db2 subsystem or the data sharing group where the object definitions and data are migrated (copied) to.

    

     Note: If you specify the data sharing group, the first active Db2 subsystem in the group is used. 



  change_set (type: str)
    Specifies the creator and name of an existing RC/Migrator global change set to be used to modify Db2 object attributes when preparing objects for migration. 

    

    Format:

    

    \<change-set-creator.change-set-name\> 

    

    For more information about global change services, see the RC/Migrator documentation at https://techdocs.broadcom.com/db2rcmig

    

    Note: If change-set and change-set-file are both specified, specifications in change-set-file take precedence. 



  change_set_file (type: str)
    Specifies the name of the local input file that contains the global change specifications to modify Db2 object attributes when preparing for migration.

    

    Format:

    

    \<object-attribute\> \<from-value\> \<to-value\>

       

    The \<object-attribute\> consists of four characters. The first two characters identify the object type. The last two characters identify the specific attribute. Wildcard characters are supported in the \<from-value\> and \<to-value\>. The first occurrence in multiple specifications for the same \<object-attribute\> has the highest precedence.

      

    For a list of global change set attributes, see the RC/Migrator documentation at https://techdocs.broadcom.com/db2rcmig

    

    Example:

       

    The following example demonstrates changes to tableâ€™s schema (creator) and tablespace names:

        

    TBCR TEST% PROD%

    TBTS TESTTS% PRODTS%

     

    Note: If change-set and change-set-file are both specified, specifications in change-set-file take precedence. 



  output_migrate_script (type: str)
    Specifies the local output file name that contains the script to make changes to the target Db2 subsystem.

     

    Default value: migration.txt 



  output_ddl_file (type: str)
    Specifies the local output file name that contains the generated DDL for the input objects that are identified by the or option.

    

    Default value: output.sql 



  modification (type: str)
    Identifies a named set of server-managed default parameter values that control the execution behavior of the zowe dbm-db2 commands. For example, you can use a modification to identify a set of default values that differ from the set of values that are normally used.

      

    For more information about using the modification option, see the DBM Data Service documentation at https://techdocs.broadcom.com/db2mgmt .



  error_file (type: str)
    Specifies the local output error file in YAML format that contains basic execution information, connection details, dbm-db2 profile parameters, used arguments, and errors that occurred during execution of the command.

          

    Default value: error.log 



  job_cards (type: list)
    Specifies a string array of z/OS JCL JOB statements.



  work_dataset_prefix (type: str)
    Specifies the prefix that is used as the high level qualifier in z/OS work data set names.



  authid (type: str)
    Specifies the primary Db2 authorization ID (user ID) that is used to establish a connection between Db2 and a process.



  sqlid (type: str)
    Specifies the authorization ID that is used as the value in generated SET CURRENT SQLID statements most of the time.



  termination_character (type: str)
    Specifies the SQL termination character that you want to use to terminate object DDL for triggers, XML indexes, functions, and procedures that contain embedded semicolon-terminated SQL statements. You cannot use a comma, an underscore, a single quote, double quotes, left parentheses, or right parentheses for this value.



  overwrite_output_files (type: bool)
    Specifies whether to overwrite output files when they already exist.



  protocol (type: str)
    Specifies the communication protocol to use between the zowe dbm-db2 client and the DBM Data Service.


    Choices:
      * ``http`` 
      * ``https`` 

  environment_list (type: str)
    Specifies an object of one or more values consisting of a Db2 subsystem ID and a DBM Data Service environment pair. The paired entry identifies the DBM Data Service environment to use for a subsystem that is accessible through multiple DBM Data Service environments. For more information about configuring the DBM Data Service, see the Database Management Solutions for Db2 for z/OS documentation at https://techdocs.broadcom.com/db2mgmt.



  host (type: str)
    Host name of service on the mainframe.



  port (type: int)
    Port number of service on the mainframe.



  user (type: str)
    User name to authenticate to service on the mainframe.



  password (type: str)
    Password to authenticate to service on the mainframe.



  reject_unauthorized (type: bool, default: ``True``)
    Reject self-signed certificates.



  cert_file (type: path)
    The file path to a certificate file to use for authentication.

    

    Note: The CLI does not support certificate files that require a password. For more information, search Troubleshooting PEM Certificates in Zowe Docs.



  cert_key_file (type: path)
    The file path to a certificate key file to use for authentication.










Examples
--------

.. code-block:: yaml+jinja

    
    - name: Generate a migration script for a tablespace and its child table
      broadcom.dbm_db2.prepare_migration:
        object: tablespace my.tbsp include(table)
        source_db2: SRC
        target_db2: TRG
        output_migrate_script: migrate.txt

    - name: Generate a migration script and apply global changes
      broadcom.dbm_db2.prepare_migration:
        object: database my.db include(children)
        source_db2: SRC
        target_db2: TRG
        change_set: USER1.CHANGSET
        output_migrate_script: migrate.txt
        output_ddl_file: objects.sql




Return Values
-------------

data (type: list, *when returned data is a dictionary*)
  Data from the module execution (a data structure). The items of this dict are set as individual return values on the top level as well.


error (type: complex, *error*)
  More details about why the action has failed. If the failure is when calling an API service, the response contains the connection parameters.


  additional_details (type: str)
    Detailed message about the failure.


  msg (type: str)
    Short description of the result or failure.


  request (type: str, *API request failed*)
    HTTP method used to invoke API service request.


  resource (type: str, *API request failed*)
    URI of the resource of the API service request.



failed (type: bool, *always*)
  A boolean that indicates if the task was failed or not.


list (type: list, *when returned data is a list*)
  Data from the module execution (a list of data structures).


msg (type: str, *sometimes*)
  Short description of the result or failure.


rc (type: int, *always*)
  Exit code of the module, successful exit code is 0, failure is typically 1 or higher.


stderr (type: str, *error*)
  Details of the error.


stdout (type: str, *success*)
  Summary of the result.





Status
------




- This module is maintained by Broadcom.



